# ç”µæ± å¾ªç¯å¯¿å‘½é¢„æµ‹é¡¹ç›® (Battery Cycle Life Prediction)

åŸºäºåˆå§‹å¾ªç¯æ•°æ®çš„é”‚ç¦»å­ç”µæ± å‰©ä½™å¾ªç¯å¯¿å‘½æœºå™¨å­¦ä¹ é¢„æµ‹é¡¹ç›®ï¼Œå®ç°äº†Nature Energy 2019å¹´è®ºæ–‡çš„ç ”ç©¶æ–¹æ³•ã€‚

## ğŸ“‹ é¡¹ç›®ç®€ä»‹ (Project Overview)

æœ¬é¡¹ç›®ä½¿ç”¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ æ–¹æ³•ï¼Œä»…åŸºäºç”µæ± å‰100ä¸ªå……æ”¾ç”µå¾ªç¯çš„æ•°æ®ï¼Œå‡†ç¡®é¢„æµ‹é”‚ç¦»å­ç”µæ± çš„å‰©ä½™å¾ªç¯å¯¿å‘½ã€‚é¡¹ç›®å®ç°äº†å¤šç§ç®—æ³•æ¨¡å‹ï¼ŒåŒ…æ‹¬ä¼ ç»Ÿçš„æœºå™¨å­¦ä¹ æ–¹æ³•å’ŒåŸºäºCNNçš„æ·±åº¦å­¦ä¹ æ–¹æ³•ï¼Œé¢„æµ‹è¯¯å·®å¯è¾¾çº¦8%ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„ (Project Structure)

```
battery_prediction/
â”œâ”€â”€ main.py                     # ä¸»ç¨‹åºå…¥å£ï¼Œæ”¯æŒ5ç§æ¨¡å‹
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–åŒ…
â”œâ”€â”€ data_preprocess/            # æ•°æ®é¢„å¤„ç†æ¨¡å—
â”‚   â””â”€â”€ data_loader.py          # æ•°æ®åŠ è½½å’Œæ¸…æ´—
â”œâ”€â”€ feature_extraction/         # ç‰¹å¾æå–æ¨¡å—
â”‚   â”œâ”€â”€ standard.py             # æ ‡å‡†ç‰¹å¾ï¼ˆ9ç»´ï¼‰
â”‚   â”œâ”€â”€ extended.py             # æ‰©å±•ç‰¹å¾ï¼ˆ12ç»´ï¼‰
â”‚   â””â”€â”€ cnn_feature.py          # CNNå›¾å½¢ç‰¹å¾
â”œâ”€â”€ models/                     # æ¨¡å‹å®ç°
â”‚   â”œâ”€â”€ base.py                 # åŸºç¡€æŠ½è±¡ç±»
â”‚   â”œâ”€â”€ elastic_net.py          # ElasticNetå›å½’
â”‚   â”œâ”€â”€ xgb.py                  # XGBoost
â”‚   â”œâ”€â”€ rf.py                   # éšæœºæ£®æ—
â”‚   â”œâ”€â”€ extra_trees.py          # æç«¯éšæœºæ ‘
â”‚   |â”€â”€ CNN.py                  # CNN-æ·±åº¦å­¦ä¹ 
|   |â”€â”€ CNN_utils/                  # CNNå·¥å…·ç±»
â”‚     â”œâ”€â”€ network.py              # AlexNetç½‘ç»œæ¶æ„
â”‚     â””â”€â”€ dataset.py              # PyTorchæ•°æ®é›†
â”œâ”€â”€ config.py                   # é…ç½®ç®¡ç†
â”œâ”€â”€ Data/                       # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ batch1.pkl              # é¢„å¤„ç†æ•°æ®é›†1
â”‚   â”œâ”€â”€ batch2.pkl              # é¢„å¤„ç†æ•°æ®é›†2
â”‚   â”œâ”€â”€ batch3.pkl              # é¢„å¤„ç†æ•°æ®é›†3
â”‚   â”œâ”€â”€ *.mat                   # åŸå§‹MATLABæ•°æ®
â”‚   â””â”€â”€ data_description.md     # æ•°æ®è¯¦ç»†è¯´æ˜
â”œâ”€â”€ params/                     # æ¨¡å‹å‚æ•°
â”‚   â”œâ”€â”€ cnn_best.pth            # CNNæœ€ä½³å‚æ•°
â”‚   â”œâ”€â”€ xgb_best.json           # XGBoostæœ€ä½³å‚æ•°
â”‚   â”œâ”€â”€ rf_best.json            # éšæœºæ£®æ—æœ€ä½³å‚æ•°
â”‚   â””â”€â”€ et_best.json            # æç«¯éšæœºæ ‘æœ€ä½³å‚æ•°
â””â”€â”€ results/                    # å®éªŒç»“æœ
    â””â”€â”€ timestamp/              # æ—¶é—´æˆ³ç»“æœæ–‡ä»¶å¤¹
        â”œâ”€â”€ results.json        # ç»“æœæ•°æ®
        â”œâ”€â”€ prediction_plot.png # é¢„æµ‹å¯è§†åŒ–
        â””â”€â”€ feature_importance.png # ç‰¹å¾é‡è¦æ€§
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)

### 1. ç¯å¢ƒé…ç½®

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. è¿è¡ŒåŸºç¡€æ¨¡å‹

åœ¨æ­¤ä¹‹å‰å¯ä»¥å…ˆä¿®æ”¹configä¸­çš„è¿è¡Œå‚æ•°ï¼Œå…·ä½“ä¿®æ”¹æ–¹å¼è§ä¸‹é¢çš„è¯´æ˜

```bash
# è¿è¡ŒElasticNetæ¨¡å‹
python main.py --model elasticnet

# è¿è¡ŒXGBoostæ¨¡å‹
python main.py --model xgboost

# è¿è¡Œéšæœºæ£®æ—æ¨¡å‹
python main.py --model rf

# è¿è¡Œæç«¯éšæœºæ ‘æ¨¡å‹
python main.py --model extratrees

# è¿è¡ŒCNNæ·±åº¦å­¦ä¹ æ¨¡å‹
python main.py --model cnn
```

## ğŸ“Š æ•°æ®é›†è¯´æ˜ (Dataset)

### æ•°æ®æ¥æº
- **æ¥æº**: Nature Energy 2019å¹´è®ºæ–‡ã€ŠData-driven prediction of battery cycle life before capacity degradationã€‹
- **ç”µæ± ç±»å‹**: å•†ç”¨LFP/çŸ³å¢¨é”‚ç¦»å­ç”µæ±  (A123 Systems APR18650M1A, 1.1 Ah)
- **æ•°æ®è§„æ¨¡**: 124èŠ‚ç”µæ± ï¼Œ72ç§å¿«å……ç­–ç•¥ï¼Œæ€»è®¡çº¦96,700æ¬¡å¾ªç¯
- **å¾ªç¯å¯¿å‘½**: 150-2300æ¬¡ï¼Œå¹³å‡806Â±377æ¬¡

### æ•°æ®ç»“æ„
```
Data/
â”œâ”€â”€ batch1.pkl     # 41èŠ‚ç”µæ±  (è®­ç»ƒé›†)
â”œâ”€â”€ batch2.pkl     # 43èŠ‚ç”µæ±  (è®­ç»ƒé›†)
â””â”€â”€ batch3.pkl     # 40èŠ‚ç”µæ±  (æµ‹è¯•é›†)
```

æ¯èŠ‚ç”µæ± æ•°æ®åŒ…å«:
- `cycle_life`: æ€»å¾ªç¯å¯¿å‘½ï¼ˆç›®æ ‡å˜é‡ï¼‰
- `charge_policy`: å……ç”µç­–ç•¥
- `summary`: æ¯å¾ªç¯æ±‡æ€»ç»Ÿè®¡ï¼ˆå®¹é‡ã€å†…é˜»ã€æ¸©åº¦ç­‰ï¼‰
- `cycles`: è¯¦ç»†æ—¶é—´åºåˆ—æ•°æ®ï¼ˆç”µå‹ã€ç”µæµã€æ¸©åº¦ç­‰ï¼‰

## ğŸ§  ç‰¹å¾å·¥ç¨‹ (Feature Engineering)

### æ ‡å‡†ç‰¹å¾ (9ç»´)
1. **DeltaQ_var**: Q100-Q10å·®å¼‚çš„å¯¹æ•°æ–¹å·®
2. **DeltaQ_min**: Q100-Q10å·®å¼‚çš„å¯¹æ•°æœ€å°å€¼
3. **CapFadeCycle2Slope/Intercept**: å®¹é‡è¡°å‡çº¿æ€§æ‹Ÿåˆ
4. **Qd2**: ç¬¬2æ¬¡å¾ªç¯æ”¾ç”µå®¹é‡
5. **AvgChargeTime**: å‰5æ¬¡å¾ªç¯å¹³å‡å……ç”µæ—¶é—´
6. **IntegralTemp**: 2-100æ¬¡å¾ªç¯æ¸©åº¦ç§¯åˆ†
7. **MinIR**: æœ€å°å†…é˜»
8. **IRDiff2And100**: ç¬¬2æ¬¡ä¸ç¬¬100æ¬¡å¾ªç¯å†…é˜»å·®

### æ‰©å±•ç‰¹å¾ (12ç»´)
åœ¨æ ‡å‡†ç‰¹å¾åŸºç¡€ä¸Šå¢åŠ :
- **DeltaQc_var**: å……ç”µå®¹é‡å·®å¼‚æ–¹å·®
- **DeltaQc_min**: å……ç”µå®¹é‡å·®å¼‚æœ€å°å€¼
- **ChargingPolicy**: å……ç”µç­–ç•¥ç¼–ç 

### CNNå›¾å½¢ç‰¹å¾
å°†æ—¶é—´åºåˆ—è½¬æ¢ä¸º3é€šé“å›¾åƒ:
- **é€šé“1**: Q(V)æ›²çº¿ï¼ˆå®¹é‡-ç”µå‹å…³ç³»ï¼‰
- **é€šé“2**: dQ/dVæ›²çº¿ï¼ˆå¢é‡å®¹é‡ï¼‰
- **é€šé“3**: Î”Qæ›²çº¿ï¼ˆç›¸å¯¹å®¹é‡å·®ï¼‰
- **å°ºå¯¸**: 224Ã—224åƒç´ ï¼Œé€‚é…AlexNetè¾“å…¥

## ğŸ¤– æ¨¡å‹å®ç° (Models)

### ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ¨¡å‹

| æ¨¡å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| ElasticNet | L1+L2æ­£åˆ™åŒ–ï¼Œç‰¹å¾é€‰æ‹© | é«˜ç»´ç¨€ç–æ•°æ® |
| XGBoost | æ¢¯åº¦æå‡ï¼Œè‡ªåŠ¨ç‰¹å¾é‡è¦æ€§ | å¤æ‚éçº¿æ€§å…³ç³» |
| Random Forest | éšæœºç‰¹å¾é€‰æ‹©ï¼ŒæŠ—è¿‡æ‹Ÿåˆ | ç¨³å¥æ€§è¦æ±‚é«˜ |
| Extra Trees | æç«¯éšæœºåŒ–ï¼Œè®­ç»ƒå¿«é€Ÿ | å¿«é€ŸåŸå‹å¼€å‘ |

### æ·±åº¦å­¦ä¹ æ¨¡å‹

**CNN-å›¾åƒè¯†åˆ«**:
- **éª¨å¹²ç½‘ç»œ**: é¢„è®­ç»ƒAlexNet (ImageNet)
- **å¾®è°ƒç­–ç•¥**: å†»ç»“æ—©æœŸå±‚ï¼Œè®­ç»ƒåˆ†ç±»å™¨å’ŒåæœŸå·ç§¯å±‚
- **ç›®æ ‡å½’ä¸€åŒ–**: Min-Maxç¼©æ”¾è‡³[0,1]
- **æ—©åœæœºåˆ¶**: Patience-basedé˜²æ­¢è¿‡æ‹Ÿåˆ

## âš™ï¸ é…ç½®é€‰é¡¹ (Configuration)

### æ•°æ®åˆ†å‰²ç­–ç•¥
```python
# config.pyä¸­çš„é…ç½®
Config:
  test_size: float = 0.2        # æµ‹è¯•é›†æ¯”ä¾‹
  val_size: float = 0.2         # éªŒè¯é›†æ¯”ä¾‹
  random_split: bool = False    # False=æŒ‰æ‰¹æ¬¡åˆ†å‰²
  outlier_threshold: int = 3    # 3Ïƒå¼‚å¸¸å€¼å‰”é™¤
```

### æ¨¡å‹è¶…å‚æ•°
æ¯ä¸ªæ¨¡å‹éƒ½æœ‰ç‹¬ç«‹çš„é…ç½®ç±»ï¼Œæ”¯æŒ:
- ç½‘æ ¼æœç´¢å‚æ•°èŒƒå›´
- äº¤å‰éªŒè¯æŠ˜æ•°
- æ—©åœpatience
- å­¦ä¹ ç‡å’Œæ­£åˆ™åŒ–å‚æ•°

## ğŸ“ˆ è¯„ä¼°æŒ‡æ ‡ (Metrics)

- **MSE**: å‡æ–¹è¯¯å·® (MSE = 1/n Î£(yi - Å·i)Â²)
- **RMSE**: å‡æ–¹æ ¹è¯¯å·® (RMSE = âˆšMSE)
- **MPE**: å¹³å‡ç™¾åˆ†æ¯”è¯¯å·® (MPE = 100%/n Î£(yi - Å·i)/yi)
- **RÂ²**: å†³å®šç³»æ•° (RÂ² = 1 - SSE/SST)

æ³¨æ„: CNNæ¨¡å‹çš„é¢„æµ‹ç»“æœéœ€è¦åå½’ä¸€åŒ–åˆ°åŸå§‹å°ºåº¦è¿›è¡Œè¯„ä¼°ã€‚

## ğŸ”§ è‡ªå®šä¹‰æ‰©å±• (Customization)

### æ·»åŠ æ–°æ¨¡å‹
1. ç»§æ‰¿`models/base.py`ä¸­çš„`BaseModel`ç±»
2. å®ç°`fit()`ã€`predict()`ã€`evaluate()`æ–¹æ³•
3. åœ¨`config.py`ä¸­æ·»åŠ é…ç½®ç±»
4. åœ¨`main.py`ä¸­æ³¨å†Œæ–°æ¨¡å‹

### è‡ªå®šä¹‰ç‰¹å¾
1. åœ¨`feature_extraction/`ç›®å½•ä¸‹åˆ›å»ºæ–°æ¨¡å—
2. å®ç°`extract_features(data_dict, cycles)`æ¥å£
3. åœ¨é…ç½®ä¸­æŒ‡å®šç‰¹å¾ç±»å‹

## ğŸ“ å®éªŒç»“æœ (Experimental Results)

è¿è¡Œåçš„ç»“æœä¿å­˜åœ¨`results/`ç›®å½•ä¸‹ï¼Œæ ¼å¼å¦‚ä¸‹:
```
results/YYYY-MM-DD_HH-MM-SS/
â”œâ”€â”€ results.json           # è¯¦ç»†ç»“æœæ•°æ®
â”œâ”€â”€ prediction_plot.png    # é¢„æµ‹vså®é™…æ•£ç‚¹å›¾
â”œâ”€â”€ feature_importance.png # ç‰¹å¾é‡è¦æ€§æ’åº
â””â”€â”€ config.json           # å®éªŒé…ç½®å‚æ•°
```
## ğŸ“š å‚è€ƒæ–‡çŒ® (References)

1. **Severson, K. A., et al.** (2019). Data-driven prediction of battery cycle life before capacity degradation. *Nature Energy*, 4(5), 383-391.

2. **Attia, P. M., et al.** (2020). Closed-loop optimization of fast-charging protocols for batteries with machine learning. *Nature*, 578(7795), 395-399.
